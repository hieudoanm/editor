(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8127],{1065:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/chess/converter/pgn2gif",function(){return r(3308)}])},3308:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var n=r(4513),i=r(5569),s=r(9122),o=r(9155),a=r.n(o),h=r(1884),l=r.n(h),f=r(4285),u=r(3034),c=r(303);let p=()=>{let[{game:e=new s.d$,pgn:t=i.xi,loading:r=!1},o]=(0,f.useState)({pgn:i.xi,game:new s.d$,loading:!1}),h=(0,f.useRef)(null);return(0,n.jsxs)("div",{className:"flex w-full max-w-sm flex-col gap-y-4 overflow-x-hidden",children:[(0,n.jsx)("textarea",{rows:2,name:"pgn",placeholder:"PGN",value:t,onChange:e=>o(t=>({...t,pgn:e.target.value})),className:"w-full rounded border border-neutral-800 px-4 py-2"}),(0,n.jsxs)("div",{id:"board",ref:h,className:"relative aspect-square",children:[r?(0,n.jsx)("div",{className:"absolute top-0 right-0 bottom-0 left-0 z-10 flex items-center justify-center px-4",children:(0,n.jsx)(u.hW,{className:"animate-spin"})}):(0,n.jsx)("div",{className:"absolute top-0 right-0 bottom-0 left-0 z-10 flex items-center justify-center px-4",children:(0,n.jsx)("button",{type:"button",disabled:r,className:"cursor-pointer rounded-full bg-red-500 p-4 text-center text-neutral-100",onClick:async()=>{o(e=>({...e,loading:!0}));let e=(e=>{let t=new s.d$;return t.loadPgn(e),t.history()})(t),r=new s.d$;o(e=>({...e,game:r}));let n=[];for(let t of e)if(o(e=>{console.info(e.game.fen());let r=new s.d$(e.game.fen());return r.move(t),{...e,game:new s.d$(r.fen())}}),h.current){let e=(await l()(h.current)).toDataURL("image/png");n.push(e)}await (e=>{let{base64s:t,pgn:r}=e;return new Promise(e=>{let n=new(a())({workers:1,quality:10,workerScript:"/workers/gif.worker.js"}),i=0;t.forEach(e=>{let r=new Image;r.src=e,r.onload=()=>{n.addFrame(r,{delay:500}),++i===t.length&&n.render()}}),n.on("start",()=>{console.info("start")}),n.on("progress",e=>{console.info("progressing",e)}),n.on("finished",t=>{var n,i;let o=URL.createObjectURL(t),a=document.createElement("a");a.href=o;let h=(e=>{let t=new s.d$;return t.loadPgn(e),t.getHeaders()})(r),l="".concat(null!=(n=h.White)?n:""," vs ").concat(null!=(i=h.Black)?i:"").trim();a.download="".concat(l,".gif"),a.click(),a.remove(),e()}),n.on("abort",()=>{e()})})})({base64s:n,pgn:t}),o(e=>({...e,loading:!1}))},children:r?(0,n.jsx)(u.hW,{className:"mx-auto animate-spin"}):(0,n.jsx)(u.WCW,{className:"mx-auto"})})}),(0,n.jsx)("div",{id:"board",ref:h,className:"aspect-square w-full overflow-hidden rounded border border-neutral-800",children:(0,n.jsx)(c.V,{position:e.fen()})})]})]})};var d=r(1205),g=r(7047),m=r(9216),v=r.n(m);let x=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v(),{children:(0,n.jsx)("title",{children:"PGN to GIF"})}),(0,n.jsxs)("div",{className:"flex h-screen w-screen flex-col",children:[(0,n.jsx)(g.F,{}),(0,n.jsx)(d.c,{}),(0,n.jsx)("div",{className:"container mx-auto flex grow items-center justify-center p-8",children:(0,n.jsx)(p,{})})]})]})},9155:e=>{e.exports=(function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){if(s)return s(o,!0);var h=Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var s=void 0,o=0;o<n.length;o++)i(n[o]);return i})({1:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,a,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(void 0===(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(s(r))for(a=0,o=Array.prototype.slice.call(arguments,1),n=(h=r.slice()).length;a<n;a++)h[a].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=void 0===this._maxListeners?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(a=o;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0==arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0==arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,r){var n,i,s,o,a;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),s="ie"===(n=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(i={name:"version"===n[1]?n[3]:n[1],version:s||parseFloat("opera"===n[1]&&n[4]?n[4]:n[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,t.exports=i},{}],3:[function(e,t,r){var n,i,s=function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return -1},h=[].slice;n=e("events").EventEmitter,i=e("./browser.coffee"),t.exports=function(e){var t,r;function n(e){var r,n,i;for(n in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),t)i=t[n],null==(r=this.options)[n]&&(r[n]=i)}return s(n,e),t={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},r={delay:500,copy:!1},n.prototype.setOption=function(e,t){if(this.options[e]=t,null!=this._canvas&&("width"===e||"height"===e))return this._canvas[e]=t},n.prototype.setOptions=function(e){var t,r,n;for(t in r=[],e)o.call(e,t)&&(n=e[t],r.push(this.setOption(t,n)));return r},n.prototype.addFrame=function(e,t){var n,i;for(i in null==t&&(t={}),(n={}).transparent=this.options.transparent,r)n[i]=t[i]||r[i];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!==ImageData&&e instanceof ImageData)n.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?n.data=this.getContextData(e):n.context=e;else if(null!=e.childNodes)t.copy?n.data=this.getImageData(e):n.image=e;else throw Error("Invalid image");return this.frames.push(n)},n.prototype.render=function(){var e,t;if(this.running)throw Error("Already running");if(null==this.options.width||null==this.options.height)throw Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var e,t,r;for(r=[],e=0,t=this.frames.length;0<=t?e<t:e>t;0<=t?++e:--e)r.push(null);return r}).call(this),t=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(e=0;0<=t?e<t:e>t;0<=t?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},n.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},n.prototype.spawnWorkers=function(){var e,t,r,n;return e=Math.min(this.options.workers,this.frames.length),(function(){r=[];for(var n=t=this.freeWorkers.length;t<=e?n<e:n>e;t<=e?n++:n--)r.push(n);return r}).apply(this).forEach((n=this,function(e){var t;return n.log("spawning worker "+e),(t=new Worker(n.options.workerScript)).onmessage=function(e){return n.activeWorkers.splice(n.activeWorkers.indexOf(t),1),n.freeWorkers.push(t),n.frameFinished(e.data)},n.freeWorkers.push(t)})),e},n.prototype.frameFinished=function(e){var t,r;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,!0===this.options.globalPalette&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(t=1,r=this.freeWorkers.length;1<=r?t<r:t>r;1<=r?++t:--t)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},n.prototype.finishRendering=function(){var e,t,r,n,i,s,o,a,h,l,f,u,c,p,d,g;for(i=0,a=0,h=(p=this.imageParts).length;i<h;i++)a+=((t=p[i]).data.length-1)*t.pageSize+t.cursor;for(a+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),e=new Uint8Array(a),u=0,s=0,l=(d=this.imageParts).length;s<l;s++)for(g=(t=d[s]).data,r=o=0,f=g.length;o<f;r=++o)c=g[r],e.set(c,u),r===t.data.length-1?u+=t.cursor:u+=t.pageSize;return n=new Blob([e],{type:"image/gif"}),this.emit("finished",n,e)},n.prototype.renderNextFrame=function(){var e,t,r;if(0===this.freeWorkers.length)throw Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],r=this.freeWorkers.shift(),t=this.getTask(e),this.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(r),r.postMessage(t)},n.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},n.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},n.prototype.getTask=function(e){var t,r;if(r={index:t=this.frames.indexOf(e),last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===i.name},null!=e.data)r.data=e.data;else if(null!=e.context)r.data=this.getContextData(e.context);else if(null!=e.image)r.data=this.getImageData(e.image);else throw Error("Invalid frame");return r},n.prototype.log=function(){var e;if(e=1<=arguments.length?h.call(arguments,0):[],this.options.debug)return console.log.apply(console,e)},n}(n)},{"./browser.coffee":2,events:1}]},{},[3])(3)}},e=>{e.O(0,[963,6255,5308,8518,4357,5518,636,6593,8792],()=>e(e.s=1065)),_N_E=e.O()}]);